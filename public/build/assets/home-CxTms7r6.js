import{a}from"./axios-BimPEqV4.js";import{M as E}from"./bootstrap.esm-D_59DZ1Y.js";import{C as o,N as p}from"./app-PF3Kj-JA.js";class m{constructor(t,e,s,i,d,l,n,r,u,c,h){this.cancelUpload=()=>{},this.modalEl=document.getElementById(t),this.nameInputEl=document.getElementById(e),this.nameInputFeedbackEl=document.getElementById(s),this.zipFileInputEl=document.getElementById(i),this.zipFileInputFeedbackEl=document.getElementById(d),this.gpxFileInputEl=document.getElementById(l),this.gpxFileInputFeedbackEl=document.getElementById(n),this.uploadButtonEl=document.getElementById(r),this.cancelButtonEl=document.getElementById(u),this.progressWrapperEl=document.getElementById(c),this.progressBarEl=document.getElementById(h),this.init()}init(){this.setupUploadButton(),this.setupCloseModal()}setupUploadButton(){this.uploadButtonEl.addEventListener("click",t=>{t.preventDefault(),this.uploadFile()})}closeModal(){E.getOrCreateInstance(this.modalEl).hide(),this.resetModal()}resetModal(){this.clearInput(),this.resetProgress(),this.enabledUploadButton()}setupCloseModal(){this.cancelButtonEl.addEventListener("click",()=>{this.cancelUpload(),this.closeModal()})}clearInput(){this.nameInputEl.value="",this.nameInputEl.classList.remove("is-valid","is-invalid"),this.nameInputFeedbackEl.innerText="",this.zipFileInputEl.value="",this.zipFileInputEl.classList.remove("is-valid","is-invalid"),this.zipFileInputFeedbackEl.innerText="",this.gpxFileInputEl.value="",this.gpxFileInputEl.classList.remove("is-valid","is-invalid"),this.gpxFileInputFeedbackEl.innerText=""}uploadFile(){this.disabledUploadButton();const t=a.CancelToken.source(),e=this.nameInputEl.value.trim(),s=this.zipFileInputEl.files[0],i=this.gpxFileInputEl.files[0];if(!this.isInputValid(e,s,i)){this.enabledUploadButton();return}const l=new FormData;l.append("photoGroupName",e),l.append("zipFile",s),l.append("gpxFile",i),a.post("/",l,{headers:{"Content-Type":"multipart/form-data"},cancelToken:t.token,onUploadProgress:n=>this.updateProgress(n)}).then(n=>{this.handleUploadSuccess()}).catch(n=>{a.isCancel(n)?this.handleUploadCancel():this.handleUploadError()}),this.cancelUpload=()=>{t.cancel("アップロードが中断されました。"),this.cancelUpload=()=>{}}}disabledUploadButton(){this.uploadButtonEl.classList.remove("btn-primary"),this.uploadButtonEl.classList.add("btn-secondary"),this.uploadButtonEl.setAttribute("disabled","");const t=this.uploadButtonEl.querySelector("#uploadButtonBefore"),e=this.uploadButtonEl.querySelector("#uploadButtonAfter");t.style.display="none",e.removeAttribute("style")}enabledUploadButton(){this.uploadButtonEl.classList.remove("btn-secondary"),this.uploadButtonEl.classList.add("btn-primary"),this.uploadButtonEl.removeAttribute("disabled");const t=this.uploadButtonEl.querySelector("#uploadButtonBefore"),e=this.uploadButtonEl.querySelector("#uploadButtonAfter");t.removeAttribute("style"),e.style.display="none"}isInputValid(t,e,s){let i=!0;return t?(this.nameInputEl.classList.add("is-valid"),this.nameInputEl.classList.remove("is-invalid"),this.nameInputFeedbackEl.innerText=""):(i=!1,this.nameInputEl.classList.add("is-invalid"),this.nameInputEl.classList.remove("is-valid"),this.nameInputFeedbackEl.innerText="写真グループ名を入力してください。"),e?(this.zipFileInputEl.classList.add("is-valid"),this.zipFileInputEl.classList.remove("is-invalid"),this.zipFileInputFeedbackEl.innerText=""):(i=!1,this.zipFileInputEl.classList.add("is-invalid"),this.zipFileInputEl.classList.remove("is-valid"),this.zipFileInputFeedbackEl.innerText="zipファイルを選択してください。"),s?(this.gpxFileInputEl.classList.add("is-valid"),this.gpxFileInputEl.classList.remove("is-invalid"),this.gpxFileInputFeedbackEl.innerText=""):(i=!1,this.gpxFileInputEl.classList.add("is-invalid"),this.gpxFileInputEl.classList.remove("is-valid"),this.gpxFileInputFeedbackEl.innerText="gpxファイルを選択してください。"),i}updateProgress(t){if(t.lengthComputable){const e=Math.round(t.loaded/t.total*100);this.progressWrapperEl.removeAttribute("style"),this.progressWrapperEl.setAttribute("aria-valuenow",`${e}`),this.progressBarEl.style.width=`${e}%`,this.progressBarEl.innerText=`${e}%`}}resetProgress(){this.progressWrapperEl.style.display="none",this.progressWrapperEl.setAttribute("aria-valuenow","0"),this.progressBarEl.style.width="0",this.progressBarEl.innerText=""}handleUploadSuccess(){this.closeModal(),this.showSuccessNotification()}handleUploadCancel(){this.showCancelNotification()}handleUploadError(){this.closeModal(),this.showErrorNotification()}showSuccessNotification(){const t=o.get(),e="アップロードが完了しました。",s=p.Success;t.display(e,s)}showCancelNotification(){const t=o.get(),e="アップロードが中止されました。",s=p.Warning;t.display(e,s)}showErrorNotification(){const t=o.get(),e="アップロードに失敗しました。",s=p.Error;t.display(e,s)}}document.addEventListener("DOMContentLoaded",()=>{new m("uploadModal","nameInput","nameInputFeedback","zipFileInput","zipFileInputFeedback","gpxFileInput","gpxFileInputFeedback","uploadButton","cancelButton","progressWrapper","progressBar")});
